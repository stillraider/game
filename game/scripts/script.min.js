Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)};class ItemGrid{constructor(t,e,i,o){this.item=t,this.color=e,this.column=i,this.row=o,this.InitializeClick()}InitializeClick(){this.item.onclick=()=>{gridControl.isMouseAllowed&&gridControl.FindItemColor(this)}}InitializeStyle(){this.item.style.bottom=this.row*gridControl.SizeItem+"px",this.item.style.opacity="1"}FindMoreMatches(t,e){if(this.color==e&&!(()=>t.includes(this))()){const i=gridControl.GetTop(this),o=gridControl.GetRight(this),s=gridControl.GetBottom(this),r=gridControl.GetLeft(this);t.push(this),void 0!==i&&i.FindMoreMatches(t,e),void 0!==o&&o.FindMoreMatches(t,e),void 0!==s&&s.FindMoreMatches(t,e),void 0!==r&&r.FindMoreMatches(t,e)}}CheckItemNotDefined(){return void 0===this.item}DeleteItem(){this.item.remove(),this.item=void 0}AnimationHide(){this.item.style.transform="scale(0.6)",this.item.style.opacity="0"}}class GridControl{constructor(){this.colors=["blue","green","purple","red","yellow"],this.CountColumns=9,this.CountRow=9,this.SizeItem=60,this.CountMinItem=2,this.frameMilliSecond=300,this.itemsGrid=[],this.columsBlock=[],this.isMouseAllowed=!0,this.InitItems()}InitItems(){let t=()=>{const t=document.createElement("div");return t.className="game__list",t.style.width=this.SizeItem+"px",t.style.height=this.SizeItem*this.CountRow+7+"px",t},e=document.querySelector(".game__columns");for(let i=0;i<this.CountColumns;i++){this.itemsGrid[i]=[];let o=t();e.appendChild(o),this.columsBlock.push(o),this.CreateItems(i,this.CountRow)}this.StartAnimationItems()}CreateItems(t,e){let i=()=>this.colors[GetRandomInt(0,this.colors.length)];const o=this.CountRow-e;for(let e=o;e<this.CountRow;e++){const s=i(),r=this.CreateItemBlock(this.CountRow+(e-o),s);this.columsBlock[t].appendChild(r),this.itemsGrid[t][e]=new ItemGrid(r,s,t,e)}}CreateItemBlock(t,e){const i=document.createElement("div");return i.className="game__list-items",i.style.bottom=t*this.SizeItem+"px",i.style.height=1.12*this.SizeItem+"px",i.style.width=this.SizeItem+"px",i.style.background="url(./img/items/"+e+".webp) center/cover no-repeat",i.style.transition="all "+this.frameMilliSecond+"ms ease-out",i.style.opacity=0,i}StartAnimationItems(){setTimeout(()=>this.itemsGrid.forEach(t=>t.forEach(t=>t.InitializeStyle())),.5*this.frameMilliSecond)}FindItemColor(t){let e=[];t.FindMoreMatches(e,t.color),this.ItemSelectAction(e)}ItemSelectAction(t){t.length>=this.CountMinItem?(gameManager.AddStatistic(t.length),this.isMouseAllowed=!1,t.forEach(t=>t.AnimationHide()),setTimeout(()=>{gameManager.CheckGameAct(),this.isMouseAllowed=!0},2*this.frameMilliSecond+.5*this.frameMilliSecond),setTimeout(()=>{t.forEach(t=>t.DeleteItem()),this.Filling()},this.frameMilliSecond)):gameManager.AddStatistic(-1)}Filling(){for(let t=0;t<this.CountColumns;t++){let e=0;for(let i=0;i<this.CountRow;i++){let o=this.itemsGrid[t][i];o.CheckItemNotDefined()?e++:e>0&&(this.itemsGrid[t][i-e]=new ItemGrid(o.item,o.color,t,i-e))}this.CreateItems(t,e)}this.StartAnimationItems()}Replay(){for(let t=0;t<this.CountColumns;t++)this.itemsGrid[t].forEach(t=>t.DeleteItem()),this.CreateItems(t,this.CountRow);this.StartAnimationItems()}GetTop(t){return this.itemsGrid[t.column][t.row+1]}GetRight(t){if(void 0!==this.itemsGrid[t.column+1])return this.itemsGrid[t.column+1][t.row]}GetBottom(t){return this.itemsGrid[t.column][t.row-1]}GetLeft(t){if(void 0!==this.itemsGrid[t.column-1])return this.itemsGrid[t.column-1][t.row]}}class GameManager{constructor(){this.textScore=document.querySelector(".header__score-text"),this.textStep=document.querySelector(".header__step-text"),this.progress=document.querySelector(".header__progress-value"),this.textScoreEnd=document.querySelector(".popup__inbetweener-item"),this.headerTextPopup=document.querySelector(".popup__header-text"),this.popup=document.querySelector(".popup"),this.Score=0,this.Step=0,this.WinScore=1e3,this.MaxStep=20,this.InitClick(),this.UpdateInfo()}InitClick(){this.popup.onclick=()=>{this.Replay()}}Replay(){this.popup.style.display="none",this.Score=0,this.Step=0,this.UpdateInfo(),gridControl.Replay()}UpdateInfo(){(()=>{this.textStep.innerText=this.MaxStep-this.Step})(),(()=>{this.textScore.innerText=this.Score})(),(()=>{this.progress.style.width=(this.Score/this.WinScore*100).clamp(0,100)+"%"})()}AddStatistic(t){(()=>{this.Step++})(),-1!=t?(()=>{this.Score+=10*t})():this.CheckGameAct(),this.UpdateInfo()}CheckGameAct(){this.Score>=this.WinScore?this.GameWin():this.Step>=this.MaxStep&&this.GameOver()}GameWin(){this.headerTextPopup.innerText="Win :)",this.ShowPopup()}GameOver(){this.headerTextPopup.innerText="Потрачено :(",this.ShowPopup()}ShowPopup(){this.popup.style.display="flex",this.textScoreEnd.innerText=this.Score}}let gridControl=new GridControl,gameManager=new GameManager;function GetRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}